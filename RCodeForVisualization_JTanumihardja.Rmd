---
title: "IE6600 Team Project"
author: "Jessica Tanumihardja"
due date: "Due: "
output:
  pdf_document: default
  html_notebook: default
---

Dataset: WHO/UNICEF Joint Monitoring Programme for Water Supply, Sanitation and Hygiene (JMP) has reported country, regional and global estimates of progress on drinking water, sanitation and hygiene (WASH) since 1990 https://washdata.org/data/downloads#WLD

```{r setup, include=FALSE}
# echo=T to show the code, eval=T to show the results ----
knitr::opts_chunk$set(echo = T, eval=T) 
# Pre-load packages ----
library(tidyverse) 
library(ggplot2)
library(datasets)
library(haven)
library(readxl)
#library(caret)


```

# Import the dataset

Use the original dataset downloaded from website: https://washdata.org/data/downloads#WLD 

```{r}
#use the original dataset downloaded from the website
file_path <- "C:/Users/jtanu/Documents/Northeastern/2023SPRING/IE6600/Assignment/FinalProject/JMP_2021_WLD.xlsx"

```

## Water (TBD)

```{r , cache=TRUE}
#df_wash <- read_csv("C:/Users/jtanu/Documents/Northeastern/2023SPRING/IE6600/Assignment/FinalProject/JMP_2021_WLD.csv", 
#                      skip =1)

df_water <- read_excel(file_path, sheet = "Water", skip =2)

df_water
#head(df_water)
```
TO BE set later




## SANITATION - PIVOT LONGER

```{r reload, cache=TRUE}
#df_wash <- read_csv("C:/Users/jtanu/Documents/Northeastern/2023SPRING/IE6600/Assignment/FinalProject/JMP_2021_WLD.csv", 
#                      skip =1)

sanitation_raw <- read_excel(file_path, sheet = "Sanitation")

#head(sanitation)
```

```{r}
names(sanitation_raw)
```
### Rename Columns

```{r}
sanitation <- read_excel(file_path, sheet = "Sanitation",
                         skip = 2)

column_names <- c(
  "COUNTRY",
  "ISO3",
  "YEAR",
  "POPULATION(THOUSANDS)",
  "%URBAN",
  "NATIONAL_AtLeastBasic",
  "NATIONAL_Limited(shared)",
  "NATIONAL_Unimproved",
  "NATIONAL_OpenDefecation",
  "NATIONAL_AnnualRateOfChangeInBasic",
  "NATIONAL_AnnualRateOfChangeInOpenDefecation",
  "RURAL_AtLeastBasic",
  "RURAL_Limited(shared)",
  "RURAL_Unimproved",
  "RURAL_OpenDefecation",
  "RURAL_AnnualRateOfChangeInBasic",
  "RURAL_AnnualRateOfChangeInOpenDefecation",
  "URBAN_AtLeastBasic",
  "URBAN_Limited(shared)",
  "URBAN_Unimproved",
  "URBAN_Open defecation",
  "URBAN_AnnualRateOfChangeInBasic",
  "URBAN_AnnualRateOfChangeInOpenDefecation",
  "NATIONAL_SafelyManaged_Total",
  "NATIONAL_SafelyManaged_DisposedInSitu",
  "NATIONAL_SafelyManaged_EmptiedAndTreated",
  "NATIONAL_SafelyManaged_WastewaterTreated",
  "NATIONAL_SafelyManaged_TotalAnnualRateOfChange",
  "NATIONAL_FacilityType_LatrinesAndOthers",
  "NATIONAL_FacilityType_SepticTanks",
  "NATIONAL_FacilityType_SewerConnections",
  "RURAL_SafelyManaged_Total",
  "RURAL_SafelyManaged_DisposedInSitu",
  "RURAL_SafelyManaged_EmptiedAndTreated",
  "RURAL_SafelyManaged_WastewaterTreated",
  "RURAL_SafelyManaged_TotalAnnualRateOfChange",
  "RURAL_FacilityType_LatrinesAndOthers",
  "RURAL_FacilityType_SepticTanks",
  "RURAL_FacilityType_SewerConnections",
  "URBAN_SafelyManaged_Total",
  "URBAN_SafelyManaged_DisposedInSitu",
  "URBAN_SafelyManaged_EmptiedAndTreated",
  "URBAN_SafelyManaged_WastewaterTreated",
  "URBAN_SafelyManaged_TotalAnnualRateOfChange",
  "URBAN_FacilityType_LatrinesAndOthers",
  "URBAN_FacilityType_SepticTanks",
  "URBAN_FacilityType_SewerConnections",
  "SI",
  "SDGRegion", 
  "WHORegion", 
  "UNICEFProgrammingRegion", 
  "UNICEFReportingRegion"
)

sanitation <- sanitation %>% rename_with(~column_names)

sapply(sanitation, class)
```

```{r eval=FALSE}
column_names <- c(
  "COUNTRY",
  "ISO3",
  "YEAR",
  "POPULATION(THOUSANDS)",
  "%URBAN",
  "NATIONAL_AtLeastBasic",
  "NATIONAL_Limited(shared)",
  "NATIONAL_Unimproved",
  "NATIONAL_OpenDefecation",
  "NATIONAL_AnnualRateOfChangeInBasic",
  "NATIONAL_AnnualRateOfChangeInOpenDefecation",
  "RURAL_AtLeastBasic",
  "RURAL_Limited(shared)",
  "RURAL_Unimproved",
  "RURAL_OpenDefecation",
  "RURAL_AnnualRateOfChangeInBasic",
  "RURAL_AnnualRateOfChangeInOpenDefecation",
  "URBAN_AtLeastBasic",
  "URBAN_Limited(shared)",
  "URBAN_Unimproved",
  "URBAN_Open defecation",
  "URBAN_AnnualRateOfChangeInBasic",
  "URBAN_AnnualRateOfChangeInOpenDefecation",
  "NATIONAL_SafelyManaged_Total",
  "NATIONAL_SafelyManaged_DisposedInSitu",
  "NATIONAL_SafelyManaged_EmptiedAndTreated",
  "NATIONAL_SafelyManaged_WastewaterTreated",
  "NATIONAL_SafelyManaged_TotalAnnualRateOfChange",
  "NATIONAL_FacilityType_LatrinesAndOthers",
  "NATIONAL_FacilityType_SepticTanks",
  "NATIONAL_FacilityType_SewerConnections",
  "RURAL_SafelyManaged_Total",
  "RURAL_SafelyManaged_DisposedInSitu",
  "RURAL_SafelyManaged_EmptiedAndTreated",
  "RURAL_SafelyManaged_WastewaterTreated",
  "RURAL_SafelyManaged_TotalAnnualRateOfChange",
  "RURAL_FacilityType_LatrinesAndOthers",
  "RURAL_FacilityType_SepticTanks",
  "RURAL_FacilityType_SewerConnections",
  "URBAN_SafelyManaged_Total",
  "URBAN_SafelyManaged_DisposedInSitu",
  "URBAN_SafelyManaged_EmptiedAndTreated",
  "URBAN_SafelyManaged_WastewaterTreated",
  "URBAN_SafelyManaged_TotalAnnualRateOfChange",
  "URBAN_FacilityType_LatrinesAndOthers",
  "URBAN_FacilityType_SepticTanks",
  "URBAN_FacilityType_SewerConnections",
  "SI",
  "SDGRegion", 
  "WHORegion", 
  "UNICEFProgrammingRegion", 
  "UNICEFReportingRegion"
)

column_names <- c(
  "COUNTRY",
  "ISO3",
  "YEAR",
  "POPULATION(THOUSANDS)",
  "%URBAN",
  "NATIONAL_AtLeastBasic",
  "NATIONAL_Limited(shared)",
  "NATIONAL_Unimproved",
  "NATIONAL_OpenDefecation",
  "NATIONAL_AnnualRateOfChangeInBasic",
  "NATIONAL_AnnualRateOfChangeInOpenDefecation",
  "RURAL_AtLeastBasic",
  "RURAL_Limited(shared)",
  "RURAL_Unimproved",
  "RURAL_OpenDefecation",
  "RURAL_AnnualRateOfChangeInBasic",
  "RURAL_AnnualRateOfChangeInOpenDefecation",
  "URBAN_AtLeastBasic",
  "URBAN_Limited (shared)",
  "URBAN_Unimproved",
  "URBAN_Open defecation",
  "URBAN_AnnualRateOfChangeInBasic",
  "URBAN_AnnualRateOfChangeInOpenDefecation",
  "NATIONAL_Exc-SafelyManaged",
  "NATIONAL_Exc-DisposedInSitu",
  "NATIONAL_Exc-EmptiedAndTreated",
  "NATIONAL_Exc-WastewaterTreated",
  "NATIONAL_Exc-AnnualRateOfChangeInSafelyManaged",
  "NATIONAL_Inc-LatrinesAndOthers",
  "NATIONAL_Inc-SepticTanks",
  "NATIONAL_Inc-SewerConnections",
  "RURAL_Exc-SafelyManaged",
  "RURAL_Exc-DisposedInSitu",
  "RURAL_Exc-EmptiedAndTreated",
  "RURAL_Exc-WastewaterTreated",
  "RURAL_Exc-AnnualRateOfChangeInSafelyManaged",
  "RURAL_Inc-LatrinesAndOthers",
  "RURAL_Inc-SepticTanks",
  "RURAL_Inc-SewerConnections",
  "URBAN_Exc-SafelyManaged",
  "URBAN_Exc-DisposedInSitu",
  "URBAN_Exc-EmptiedAndTreated",
  "URBAN_Exc-WastewaterTreated",
  "URBAN_Exc-AnnualRateOfChangeInSafelyManaged",
  "URBAN_Inc-LatrinesAndOthers",
  "URBAN_Inc-SepticTanks",
  "URBAN_Inc-SewerConnections",
  "SI",
  "SDGRegion", 
  "WHORegion", 
  "UNICEFProgrammingRegion", 
  "UNICEFReportingRegion"
)
```



```{r eval=FALSE}
column_names
```
### Tidying data

```{r}
#tidying
sanitation <- sanitation %>% select(-SI) #remove indexing

#replace "-" with NA
sanitation <- sanitation %>% 
  mutate_all(~ifelse(. == "-", NA, .)) 

head(sanitation)
```

### Set as numeric

```{r}
#clean non numeric
#remove < and > on numbers column index 6 to 17
  #which one is better? Do this or set <1 as 0.5? 
#hygiene_data[, 6:17] <- lapply(hygiene_data[, 6:17], function(x)
#  as.numeric(gsub("\\>|<","", as.character(x)))) #or "[^[:alnum:]]" or "[^[0-9]]" 

# For now, "<1" is replaced with 0.5, and ">99" is replaced with 99.5
sanitation <- sanitation %>% 
  mutate_all(~ifelse(. == "<1", 0.5, .))

sanitation <- sanitation %>% 
  mutate_all(~ifelse(. == ">99", 99.5, .))

#set as numeric
sanitation <- sanitation %>%
  mutate_at(6:47, as.numeric)

sapply(sanitation, class)
```


### Divide to two df & Pivot Longer

Col 6:23 are one type of df, Col 24:47 are details of those df. So will separate into two df.

```{r}
### split into two df and pivot longer

#sanitation overview
sanitation1 <- sanitation %>%
  select(c(1:5, 6:23, 48:51)) %>%
  pivot_longer(
    cols = NATIONAL_AtLeastBasic:URBAN_AnnualRateOfChangeInOpenDefecation,
    names_to = c("REGION", "ServiceLevel"),
    names_sep = "_",
    values_to = "Percentage")

#sanitation details: Safely Managed Criteria and Facility Type
sanitation2 <- sanitation %>%
  select(c(1:5, 24:47, 48:51)) %>%
  pivot_longer(
    cols =  NATIONAL_SafelyManaged_Total:URBAN_FacilityType_SewerConnections,
    names_to = c("REGION", "ImprovedSanitationCriteria", "CriteriaDetails"),
    names_sep = "_",
    values_to = "Percentage")
```

```{r eval=FALSE}
names(sanitation1)
```
```{r eval=FALSE}
names(sanitation2)
```


### QUESTION

How to pivot longer? Since it has two different type of data here. We have:

* `cols = NATIONAL_AtLeastBasic:URBAN_AnnualRateOfChangeInOpenDefecation` are called "Service Level" percentage
* `cols = NATIONAL_Exc-SafelyManaged:URBAN_Inc-SewerConnections` are called "Facility Type"

Split it into two df? 

### Donut Plot - Sanitation

World summary:

```{r}
unique(sanitation1$ServiceLevel)
```

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

sanitation1 %>% 
  filter(ServiceLevel != "AnnualRateOfChangeInBasic" & 
           ServiceLevel != "AnnualRateOfChangeInOpenDefecation" &
           YEAR == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(ServiceLevel) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=ServiceLevel))+
    geom_text(aes(label = paste(round(median,2), " %")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
      # Set theme_void() to remove grid lines and everything else from the plot
    scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
    theme_void()
```

**Per country**

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

sanitation1 %>% 
  filter(ServiceLevel != "AnnualRateOfChangeInBasic" & 
           ServiceLevel != "AnnualRateOfChangeInOpenDefecation" & 
           YEAR == 2020 &
           REGION == "NATIONAL" &
           COUNTRY == "Indonesia" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(ServiceLevel) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=ServiceLevel))+
    geom_text(aes(label = paste(round(median,2), "%")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
    scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
        # Set theme_void() to remove grid lines and everything else from the plot
    theme_void()
```

**Per WHO Region**

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

sanitation1 %>% 
  filter(ServiceLevel != "AnnualRateOfChangeInBasic" & 
           ServiceLevel != "AnnualRateOfChangeInOpenDefecation" & 
           YEAR == 2020 &
           REGION == "NATIONAL" &
           WHORegion == "South-East Asia" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(ServiceLevel) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=ServiceLevel))+
    geom_text(aes(label = paste(round(median,2), "%")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
    scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
        # Set theme_void() to remove grid lines and everything else from the plot
    theme_void()
```

### Lollipop for diverging and ranking

Diverging deviation for Annual Rate of Change in Basic:

```{r}
#per country
sanitation1 %>% 
  filter(ServiceLevel == "AnnualRateOfChangeInBasic" &  
           YEAR == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  arrange(desc(Percentage)) %>% #highest first 
  head(20) %>% 
  ggplot(aes(x=COUNTRY, y=Percentage))+
    geom_segment(aes(xend=COUNTRY, yend=0)) +
    geom_point(size=6, color="lightblue") +
    geom_text(aes(label=round(Percentage,1)), color="black", size=3)+
    theme_bw() +
    labs(x="", y="median AnnualRateOfChangeInBasic %",
         title="Top 20 Countries")+
    coord_flip()
```

```{r}
#per country
sanitation1 %>% 
  filter(ServiceLevel == "AnnualRateOfChangeInBasic" & 
           YEAR == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  arrange(desc(Percentage)) %>% #highest first 
  tail(10) %>% 
  ggplot(aes(x=COUNTRY, y=Percentage))+
    geom_segment(aes(xend=COUNTRY, yend=0)) +
    geom_point(size=6, color="lightblue") +
    geom_text(aes(label=round(Percentage,2)), color="black", size=3)+
    theme_bw() +
    labs(x="", y="median AnnualRateOfChangeInBasic %",
         title="Bottom 10 countries")+
    coord_flip()
```



---------------------------------------------------------------------------------
## HYGIENE

Definition:
Hygiene refers to the conditions and practices that help maintain health and prevent spread of disease including handwashing, food hygiene, and menstrual hygiene management (https://washdata.org/monitoring/hygiene).

```{r}
hygiene_raw <- read_excel(file_path, sheet = "Hygiene") #.name_repair = "universal")

hygiene_raw
```


###Tidying Data

```{r}
#read Hygene dataset
hygiene_data <- read_excel(file_path, sheet = "Hygiene")

#rename column header accordingly (use camel type and _ to be separated later)
  #we can also rename it simultaneously with piping (see renaming population below)
hygiene_data <- rename(hygiene_data, 'NATIONAL_Basic' = 'NATIONAL')
hygiene_data <- rename(hygiene_data, 'NATIONAL_Limited(withoutWaterOrSoap)' = '...7')
hygiene_data <- rename(hygiene_data, 'NATIONAL_NoFacility' = '...8')
hygiene_data <- rename(hygiene_data, 'NATIONAL_AnnualRateOfChangeInBasic' = '...9')
hygiene_data <- rename(hygiene_data, 'RURAL_Basic' = 'RURAL')
hygiene_data <- rename(hygiene_data, 'RURAL_Limited(withoutWaterOrSoap)' = '...11')
hygiene_data <- rename(hygiene_data, 'RURAL_NoFacility' = '...12')
hygiene_data <- rename(hygiene_data, 'RURAL_AnnualRateOfChangeInBasic' = '...13')
hygiene_data <- rename(hygiene_data, 'URBAN_Basic' = 'URBAN')
hygiene_data <- rename(hygiene_data, 'URBAN_Limited(withoutWaterOrSoap)' = '...15')
hygiene_data <- rename(hygiene_data, 'URBAN_NoFacility' = '...16')
hygiene_data <- rename(hygiene_data, 'URBAN_AnnualRateOfChangeInBasic' = '...17')
hygiene_data <- rename(hygiene_data, 'SI' = '...18')
hygiene_data <- rename(hygiene_data, 'SDGRegion' = '...19')
hygiene_data <- rename(hygiene_data, 'WHORegion' = '...20')
hygiene_data <- rename(hygiene_data, 'UNICEFProgrammingRegion' = '...21')
hygiene_data <- rename(hygiene_data, 'UNICEFReportingRegion' = '...22')

#tidying
hygiene_data <- hygiene_data[-c(1),] #remove 2nd row (1st row in R)
hygiene_data <- hygiene_data %>% select(-SI) #remove indexing

#replace "-" with NA
hygiene_data <- hygiene_data %>% mutate_all(~ifelse(. == "-", NA, .))

hygiene_data
```

### Set as numeric

```{r }
#clean non numeric
#remove < and > on numbers column index 6 to 17
  #which one is better? Do this or set <1 as 0.5? 
#hygiene_data[, 6:17] <- lapply(hygiene_data[, 6:17], function(x)
#  as.numeric(gsub("\\>|<","", as.character(x)))) #or "[^[:alnum:]]" or "[^[0-9]]" 

# For now, "<1" is replaced with 0.5, and ">99" is replaced with 99.5
hygiene_data <- hygiene_data %>% mutate_all(~ifelse(. == "<1", 0.5, .))
hygiene_data <- hygiene_data %>% mutate_all(~ifelse(. == ">99", 99.5, .))

str(hygiene_data)
#hygiene_data
```

```{r}
#change the values from character to numeric
# Gives no warning such as "NAs introduced by coercion", and the mutation was successful
hygiene_data <- hygiene_data %>%
  mutate_at(6:17, as.numeric)
```


```{r}
sapply(hygiene_data, class)
```

```{r}
#rename column to standardize
hygiene_data <- hygiene_data %>% 
  rename("COUNTRY" = "HYGIENE",
         "Population.thousands" = "Population \r\n(thousands)",
         "PercentUrban" = "% urban")

hygiene_data
```

### Pivot Longer 

```{r}
#Make dataset from wide to long, see R documentation (example shown below)
hygiene_data2 <- hygiene_data %>% 
  pivot_longer(
    cols = NATIONAL_Basic:URBAN_AnnualRateOfChangeInBasic,
    names_to = c("REGION", "FacilityType"),
    names_sep = "_",
    values_to = "Percentage")

hygiene_data2
```

### Question:

* Filter != AnnualRateOfChangeInBasic?


#### WHO example

```{r eval=FALSE}
#from R documentation example:

#call dplyr dataset
who
```

```{r eval=False}
#check documentation example 

# Multiple variables stored in column names
who %>% pivot_longer(
  cols = new_sp_m014:newrel_f65,
  names_to = c("diagnosis", "gender", "age"),
  names_pattern = "new_?(.*)_(.)(.*)",
  values_to = "count"
)
```


### Preliminary Visualization

```{r}
hygiene_data2 %>% 
  filter(Area == "NATIONAL" & 
           COUNTRY == "Indonesia" &
           FacilityType =="Basic") %>% 
  ggplot(aes(x=Year, y=Percentage))+
    geom_col(aes(fill=Year)) + #aes(color=FacilityType))+
    theme_bw()
```

```{r}
#try bar chart for east & southern asia
hygiene_data2 %>% 
  filter(Area == "URBAN" & 
           SDGRegion == "Eastern and South-Eastern Asia" &
           FacilityType =="Basic") %>% 
  ggplot(aes(x=COUNTRY, y=Percentage))+
    geom_col(aes(fill=Year))+ #it aggregate the year, so need to filter per year
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```

```{r}
unique(hygiene_data2$FacilityType)
```


```{r}
hygiene_data2 %>% 
  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(FacilityType, Year) %>% 
  summarise(mean = mean(Percentage)) %>% #sum=sum(Percentage*Population.thousands)
  ggplot(aes(x=Year, y=mean))+
    geom_col(aes(fill=FacilityType), position = "dodge")+
    labs(y="World population lacking basic sanitation") +
    theme_bw() #+
    #theme(axis.text.x = element_text(angle=30, hjust=1))
```

### Donut Plot

World summary:

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

hygiene_data2 %>% 
  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(FacilityType) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=FacilityType))+
    geom_text(aes(label = paste(round(median,2), " %")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
      # Set theme_void() to remove grid lines and everything else from the plot
    #scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
    theme_void() #+
    #theme(title="median World population % lacking basic sanitation")
    #labs(y="median World population % lacking basic sanitation") #+
```

Donut chart limit:
    If xlim left boundary is big, no empty circle. You get a pie chart
    If xlim is low, the ring becomes thinner.
    
Source: https://r-charts.com/part-whole/donut-chart-ggplot2/ 
https://r-graph-gallery.com/128-ring-or-donut-plot.html 

```{r}
hygiene_data2 %>% 
  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage))
```

**Per country**

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

hygiene_data2 %>% 
  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           COUNTRY == "Indonesia" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(FacilityType) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=FacilityType))+
    geom_text(aes(label = paste(round(median,2), "%")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
    #scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
        # Set theme_void() to remove grid lines and everything else from the plot
    theme_void()
```

**Per Region**

```{r}
#set hole size to be the x axis so we can control the shape
hsize <- 3

hygiene_data2 %>% 
  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           WHORegion == "South-East Asia" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(FacilityType) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  ggplot(aes(x=hsize, y=median))+
    geom_col(aes(fill=FacilityType))+
    geom_text(aes(label = paste(round(median,2), "%")), #reduce decimal on value
            position = position_dodge(1)) +
    coord_polar(theta = "y")+ #convert bar chart to polar
      # Set the limits, which is important for adding the hole
    xlim(c(0.2, hsize + 0.5))+ #(c(2018.5, 2020.5)) +
    #scale_fill_brewer(palette = "GnBu") + #set color pallete per dataset
        # Set theme_void() to remove grid lines and everything else from the plot
    theme_void()
```


### Lollipop for rate of change or ranking

Diverging deviation for Annual Rate of Change in Basic:

```{r}
#per country
hygiene_data2 %>% 
  filter(FacilityType == "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  arrange(desc(Percentage)) %>% #highest first 
  head(20) %>% 
  ggplot(aes(x=COUNTRY, y=Percentage))+
    geom_segment(aes(xend=COUNTRY, yend=0)) +
    geom_point(size=6, color="orange") +
    geom_text(aes(label=round(Percentage,1)), color="black", size=3)+
    theme_bw() +
    labs(x="", y="median AnnualRateOfChangeInBasic %")+
    coord_flip()
```

```{r}
#per country
hygiene_data2 %>% 
  filter(FacilityType == "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  arrange(desc(Percentage)) %>% #highest first 
  tail(10) %>% 
  ggplot(aes(x=COUNTRY, y=Percentage))+
    geom_segment(aes(xend=COUNTRY, yend=0)) +
    geom_point(size=6, color="orange") +
    geom_text(aes(label=round(Percentage,2)), color="black", size=3)+
    theme_bw() +
    labs(x="", y="median AnnualRateOfChangeInBasic %")+
    coord_flip()
```

source: https://r-graph-gallery.com/302-lollipop-chart-with-conditional-color.html 
https://r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html


Per region

```{r}
hygiene_data2 %>% 
  filter(FacilityType == "AnnualRateOfChangeInBasic" & 
           Year == 2020 &
           REGION == "NATIONAL" &
           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
  group_by(WHORegion) %>% #combine all country
  summarise(median = median(Percentage)) %>% 
  arrange(desc(median)) %>% #highest first 
  ggplot(aes(x=WHORegion, y=median))+
    geom_segment(aes(xend=WHORegion, yend=0)) +
    geom_point(size=4, color="orange") +
    theme_bw() +
    labs(x="", y="median AnnualRateOfChangeInBasic %")+
    coord_flip()
```


Ranking?? (TBD)

```{r eval=FALSE}
#hygiene_data2 %>% 
#  filter(FacilityType != "AnnualRateOfChangeInBasic" & 
#           Year == 2020 &
#           REGION == "NATIONAL" &
#           !is.na(Percentage)) %>% #remove NA to prepare for calculation below
#  group_by(FacilityType, Year) %>% #combine all country
#  summarise(median = median(Percentage)) %>% 
#  ggplot(aes(x=hsize, y=median))+
```


# Question

* how to filter top and bottom rows in the same pipe?
* 
